# 共享汽车运维自动调度系统需求文档

## 1. 项目概述

### 1.1 项目背景
本项目旨在为共享汽车分时租赁业务设计一套智能化的运维自动调度系统，解决当前车辆分布无序、调度依赖经验、资源配置不合理等问题，实现数据驱动的精准调度和运维管理。

### 1.2 项目目标
- 实现车辆调度的数据化和自动化
- 建立"2-1-2"网点车辆管理标准
- 构建多运维中心协同调度机制
- 提升车辆使用效率和用户体验
- 降低运营成本，提高单车营收

### 1.3 项目范围
- 车辆实时位置和状态监控
- 网点车辆数量动态管理
- 运维中心调度指令生成
- 跨区域车辆协同调配
- 车辆保养提醒管理
- 数据分析和报表系统

## 2. 系统功能需求

### 2.1 车辆监控模块

#### 2.1.1 实时位置追踪
- **功能描述**：通过车载终端设备实时获取车辆GPS位置信息
- **技术要求**：
  - 位置更新频率：30秒/次（行驶中），5分钟/次（静止状态）
  - 定位精度：≤10米
  - 数据传输延迟：≤3秒
- **数据字段**：车牌号、经纬度、时间戳、速度、方向角

#### 2.1.2 车辆状态监控
- **功能描述**：监控车辆运行状态和关键参数
- **监控项目**：
  - 车辆在线/离线状态
  - 电量/油量水平
  - 车门锁状态
  - 发动机状态
  - 故障代码
- **告警机制**：异常状态实时推送告警信息

#### 2.1.3 里程统计
- **功能描述**：自动统计车辆行驶里程
- **统计维度**：日里程、月里程、总里程
- **保养提醒**：根据设定保养里程自动生成保养提醒

### 2.2 网点管理模块

#### 2.2.1 网点车辆计数
- **功能描述**：实时统计各网点车辆数量
- **计数逻辑**：
  - 基于车辆GPS位置判断所属网点
  - 网点范围：半径50米的圆形区域
  - 停留时间：≥5分钟认定为停放

#### 2.2.2 "2-1-2"规则引擎
- **功能描述**：实现网点车辆数量的自动调节
- **触发条件**：
  - 车辆数从2→1：触发补充调度
  - 车辆数从2→3：触发回收调度
- **响应时间**：状态变化后5分钟内生成调度指令

#### 2.2.3 网点需求预测
- **功能描述**：基于历史数据预测网点用车需求
- **预测算法**：
  - 时间序列分析
  - 考虑天气、节假日等因素
  - 预测准确率目标：≥80%

### 2.3 调度指令模块

#### 2.3.1 自动调度算法
- **功能描述**：根据网点状态变化自动生成最优调度方案
- **算法要素**：
  - 距离最短原则
  - 运维人员工作负荷均衡
  - 车辆电量/油量状态
  - 交通状况实时数据

#### 2.3.2 指令推送系统
- **功能描述**：向运维人员推送调度指令
- **推送方式**：手机APP推送、短信、语音通知
- **指令内容**：
  - 任务类型（补充/回收）
  - 源网点和目标网点
  - 车辆信息（车牌号、位置）
  - 预计用时和路线

#### 2.3.3 任务执行跟踪
- **功能描述**：跟踪调度任务的执行状态
- **状态管理**：待执行、执行中、已完成、异常
- **超时处理**：任务超时自动重新分配或升级处理

### 2.4 运维中心协同模块

#### 2.4.1 区域车辆统计
- **功能描述**：统计各运维中心管辖区域的车辆分布
- **统计维度**：
  - 在网点车辆数
  - 运维中心库存车辆数
  - 在途车辆数
  - 维修保养车辆数

#### 2.4.2 跨区域调配
- **功能描述**：运维中心间车辆余缺调配
- **触发条件**：
  - 某区域库存车辆<安全库存下限
  - 某区域库存车辆>安全库存上限
- **调配策略**：就近原则、成本最优

#### 2.4.3 协同决策支持
- **功能描述**：为运维中心间协调提供数据支持
- **决策因素**：
  - 各区域需求预测
  - 车辆流动趋势分析
  - 运营成本评估

### 2.5 保养管理模块

#### 2.5.1 保养计划管理
- **功能描述**：制定和管理车辆保养计划
- **保养类型**：
  - 定期保养（按里程）
  - 定时保养（按时间）
  - 故障维修
- **提醒机制**：提前1000公里或7天提醒

#### 2.5.2 保养记录管理
- **功能描述**：记录车辆保养历史
- **记录内容**：保养时间、里程、项目、费用、维修厂
- **统计分析**：保养成本分析、故障率统计

### 2.6 数据分析模块

#### 2.6.1 运营数据统计
- **功能描述**：统计关键运营指标
- **统计指标**：
  - 车辆使用率
  - 网点周转率
  - 调度响应时间
  - 用户满意度

#### 2.6.2 报表生成
- **功能描述**：生成各类运营报表
- **报表类型**：
  - 日报、周报、月报
  - 车辆运营报表
  - 网点分析报表
  - 调度效率报表

## 3. 系统非功能需求

### 3.1 性能要求
- **响应时间**：页面加载≤3秒，查询响应≤2秒
- **并发用户**：支持100个并发用户
- **数据处理**：支持1000台车辆实时数据处理
- **可用性**：系统可用性≥99.5%

### 3.2 安全要求
- **数据加密**：传输数据采用HTTPS加密
- **访问控制**：基于角色的权限管理
- **数据备份**：每日自动备份，异地存储
- **日志审计**：完整的操作日志记录

### 3.3 兼容性要求
- **移动端**：支持iOS 12+、Android 8+
- **浏览器**：支持Chrome、Safari、Firefox最新版本
- **设备接口**：兼容主流车载终端设备

## 4. 系统架构设计

### 4.1 总体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   移动端APP     │    │   Web管理后台   │    │   车载终端设备   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │              API网关层                          │
         └─────────────────────────────────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │              业务服务层                         │
         │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
         │  │车辆监控 │ │网点管理 │ │调度引擎 │ │数据分析 │ │
         │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ │
         └─────────────────────────────────────────────────┘
                                 │
         ┌─────────────────────────────────────────────────┐
         │              数据存储层                         │
         │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
         │  │MySQL    │ │Redis    │ │MongoDB  │ │InfluxDB │ │
         │  │业务数据 │ │缓存数据 │ │日志数据 │ │时序数据 │ │
         │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ │
         └─────────────────────────────────────────────────┘
```

### 4.2 技术栈选择

#### 4.2.1 后端技术
- **开发语言**：Java 11+
- **框架**：Spring Boot 2.7+、Spring Cloud
- **数据库**：MySQL 8.0（业务数据）、Redis 6.0（缓存）
- **时序数据库**：InfluxDB 2.0（车辆轨迹数据）
- **消息队列**：RabbitMQ 3.9+
- **搜索引擎**：Elasticsearch 7.0+

#### 4.2.2 前端技术
- **Web前端**：Vue.js 3.0+、Element Plus
- **移动端**：Flutter 3.0+
- **地图服务**：高德地图API
- **图表组件**：ECharts 5.0+

#### 4.2.3 基础设施
- **容器化**：Docker、Kubernetes
- **监控**：Prometheus + Grafana
- **日志**：ELK Stack
- **CI/CD**：Jenkins、GitLab CI

## 5. 数据库设计

### 5.1 核心数据表

#### 5.1.1 车辆信息表（vehicles）
```sql
CREATE TABLE vehicles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    license_plate VARCHAR(20) NOT NULL UNIQUE COMMENT '车牌号',
    vehicle_model VARCHAR(50) NOT NULL COMMENT '车型',
    device_id VARCHAR(50) NOT NULL UNIQUE COMMENT '终端设备ID',
    maintenance_mileage INT DEFAULT 5000 COMMENT '保养里程间隔',
    current_mileage INT DEFAULT 0 COMMENT '当前里程',
    status ENUM('online', 'offline', 'maintenance', 'fault') DEFAULT 'offline',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 5.1.2 网点信息表（stations）
```sql
CREATE TABLE stations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    station_code VARCHAR(20) NOT NULL UNIQUE COMMENT '网点编码',
    station_name VARCHAR(100) NOT NULL COMMENT '网点名称',
    latitude DECIMAL(10,7) NOT NULL COMMENT '纬度',
    longitude DECIMAL(10,7) NOT NULL COMMENT '经度',
    radius INT DEFAULT 50 COMMENT '网点半径(米)',
    target_vehicle_count INT DEFAULT 2 COMMENT '目标车辆数',
    maintenance_center_id BIGINT COMMENT '所属运维中心ID',
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 5.1.3 车辆位置历史表（vehicle_locations）
```sql
CREATE TABLE vehicle_locations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    vehicle_id BIGINT NOT NULL,
    latitude DECIMAL(10,7) NOT NULL,
    longitude DECIMAL(10,7) NOT NULL,
    speed DECIMAL(5,2) DEFAULT 0 COMMENT '速度(km/h)',
    direction INT DEFAULT 0 COMMENT '方向角(0-360)',
    station_id BIGINT COMMENT '所在网点ID',
    recorded_at TIMESTAMP NOT NULL,
    INDEX idx_vehicle_time (vehicle_id, recorded_at),
    INDEX idx_station_time (station_id, recorded_at)
);
```

#### 5.1.4 调度任务表（dispatch_tasks）
```sql
CREATE TABLE dispatch_tasks (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_type ENUM('supplement', 'retrieve') NOT NULL COMMENT '任务类型',
    vehicle_id BIGINT NOT NULL,
    source_station_id BIGINT COMMENT '源网点ID',
    target_station_id BIGINT NOT NULL COMMENT '目标网点ID',
    assigned_staff_id BIGINT COMMENT '分配的运维人员ID',
    status ENUM('pending', 'assigned', 'in_progress', 'completed', 'cancelled') DEFAULT 'pending',
    priority INT DEFAULT 1 COMMENT '优先级(1-5)',
    estimated_duration INT COMMENT '预计用时(分钟)',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    assigned_at TIMESTAMP NULL,
    started_at TIMESTAMP NULL,
    completed_at TIMESTAMP NULL
);
```

### 5.2 时序数据设计（InfluxDB）

#### 5.2.1 车辆实时状态数据
```
measurement: vehicle_status
tags:
  - vehicle_id: 车辆ID
  - license_plate: 车牌号
fields:
  - latitude: 纬度
  - longitude: 经度
  - speed: 速度
  - battery_level: 电量百分比
  - fuel_level: 油量百分比
  - engine_status: 发动机状态
  - door_locked: 车门锁状态
time: 时间戳
```

#### 5.2.2 网点车辆统计数据
```
measurement: station_vehicle_count
tags:
  - station_id: 网点ID
  - station_code: 网点编码
fields:
  - vehicle_count: 当前车辆数
  - target_count: 目标车辆数
  - variance: 差值
time: 时间戳
```

## 6. 接口设计

### 6.1 车辆监控接口

#### 6.1.1 获取车辆实时状态
```
GET /api/v1/vehicles/{vehicleId}/status

Response:
{
  "code": 200,
  "data": {
    "vehicleId": 1001,
    "licensePlate": "川A12345",
    "location": {
      "latitude": 30.572815,
      "longitude": 104.066801,
      "address": "成都市锦江区春熙路"
    },
    "status": "online",
    "batteryLevel": 85,
    "mileage": 12580,
    "lastUpdate": "2025-09-03T18:30:00Z"
  }
}
```

#### 6.1.2 批量获取车辆位置
```
GET /api/v1/vehicles/locations?stationId=1001&status=online

Response:
{
  "code": 200,
  "data": {
    "total": 135,
    "vehicles": [
      {
        "vehicleId": 1001,
        "licensePlate": "川A12345",
        "latitude": 30.572815,
        "longitude": 104.066801,
        "stationId": 1001,
        "stationName": "春熙路网点"
      }
    ]
  }
}
```

### 6.2 调度管理接口

#### 6.2.1 创建调度任务
```
POST /api/v1/dispatch/tasks

Request:
{
  "taskType": "supplement",
  "targetStationId": 1001,
  "priority": 2,
  "notes": "春熙路网点急需补充车辆"
}

Response:
{
  "code": 200,
  "data": {
    "taskId": 10001,
    "status": "pending",
    "estimatedDuration": 25,
    "createdAt": "2025-09-03T18:30:00Z"
  }
}
```

#### 6.2.2 获取调度任务列表
```
GET /api/v1/dispatch/tasks?status=pending&staffId=2001

Response:
{
  "code": 200,
  "data": {
    "total": 5,
    "tasks": [
      {
        "taskId": 10001,
        "taskType": "supplement",
        "vehicle": {
          "licensePlate": "川A12345",
          "currentLocation": "运维中心A"
        },
        "targetStation": {
          "stationName": "春熙路网点",
          "address": "成都市锦江区春熙路"
        },
        "priority": 2,
        "estimatedDuration": 25,
        "status": "pending"
      }
    ]
  }
}
```

### 6.3 数据分析接口

#### 6.3.1 获取运营统计数据
```
GET /api/v1/analytics/operations?startDate=2025-09-01&endDate=2025-09-03

Response:
{
  "code": 200,
  "data": {
    "vehicleUtilization": 78.5,
    "averageResponseTime": 18.2,
    "completedTasks": 156,
    "stationCoverage": 95.2,
    "dailyStats": [
      {
        "date": "2025-09-01",
        "utilization": 76.3,
        "tasks": 52
      }
    ]
  }
}
```

## 7. 部署方案

### 7.1 环境规划

#### 7.1.1 开发环境
- **服务器配置**：4核8GB内存，100GB SSD
- **数据库**：MySQL 8.0、Redis 6.0
- **部署方式**：Docker Compose

#### 7.1.2 测试环境
- **服务器配置**：8核16GB内存，200GB SSD
- **数据库**：MySQL 8.0主从、Redis集群
- **部署方式**：Kubernetes

#### 7.1.3 生产环境
- **应用服务器**：16核32GB内存，500GB SSD × 3台
- **数据库服务器**：32核64GB内存，1TB SSD × 2台（主从）
- **缓存服务器**：16核32GB内存，200GB SSD × 3台（集群）
- **负载均衡**：Nginx + Keepalived

### 7.2 监控告警

#### 7.2.1 系统监控
- **CPU使用率**：>80%告警
- **内存使用率**：>85%告警
- **磁盘使用率**：>90%告警
- **网络延迟**：>100ms告警

#### 7.2.2 业务监控
- **车辆离线率**：>5%告警
- **调度响应时间**：>30分钟告警
- **系统可用性**：<99%告警
- **数据同步延迟**：>5分钟告警

## 8. 项目计划

### 8.1 开发阶段

#### 第一阶段（4周）：基础框架搭建
- 项目架构搭建
- 数据库设计和创建
- 基础服务开发
- 车辆监控模块开发

#### 第二阶段（4周）：核心功能开发
- 网点管理模块开发
- 调度引擎开发
- "2-1-2"规则实现
- 移动端APP开发

#### 第三阶段（3周）：高级功能开发
- 运维中心协同模块
- 数据分析模块
- 报表系统开发
- 保养管理模块

#### 第四阶段（2周）：测试和优化
- 功能测试
- 性能测试
- 安全测试
- 系统优化

#### 第五阶段（1周）：部署上线
- 生产环境部署
- 数据迁移
- 用户培训
- 系统上线

### 8.2 里程碑
- **M1**：基础框架完成（第4周）
- **M2**：核心功能完成（第8周）
- **M3**：系统功能完整（第11周）
- **M4**：测试完成（第13周）
- **M5**：系统上线（第14周）

## 9. 风险评估

### 9.1 技术风险
- **车载设备兼容性**：不同厂商设备接口差异
- **GPS定位精度**：城市峡谷效应影响定位
- **网络连接稳定性**：移动网络信号不稳定

### 9.2 业务风险
- **用户接受度**：运维人员对新系统的接受程度
- **数据准确性**：历史数据质量影响算法效果
- **运营成本**：系统维护和硬件成本

### 9.3 风险应对
- **技术风险**：制定设备兼容性标准，建立测试环境
- **业务风险**：加强用户培训，建立反馈机制
- **成本控制**：分阶段实施，控制投资风险

## 10. 成本估算

### 10.1 开发成本
- **人力成本**：14周 × 5人 × 2万元/人月 ≈ 35万元
- **硬件成本**：服务器、网络设备 ≈ 15万元
- **软件许可**：数据库、监控工具 ≈ 5万元
- **第三方服务**：地图API、短信服务 ≈ 2万元/年

### 10.2 运营成本
- **服务器租赁**：3万元/年
- **带宽费用**：2万元/年
- **维护人员**：2人 × 1万元/人月 = 24万元/年
- **第三方服务**：2万元/年

### 10.3 总投资
- **初期投资**：57万元
- **年运营成本**：31万元
- **3年总成本**：150万元

## 11. 预期收益

### 11.1 效率提升
- **调度响应时间**：从平均45分钟降至15分钟
- **车辆使用率**：提升15-20%
- **运维人员效率**：提升30%

### 11.2 成本节约
- **人力成本**：减少2名运维人员，节约24万元/年
- **燃油成本**：优化调度路线，节约10%燃油费用
- **车辆损耗**：及时保养，延长车辆使用寿命

### 11.3 收入增长
- **单车营收**：预计提升20%，从1970元/台提升至2364元/台
- **用户满意度**：提升用户体验，增加用户粘性
- **市场竞争力**：数据化运营提升竞争优势

---

**文档版本**：v1.0  
**创建日期**：2025-09-03  
**创建人**：AI智能体  
**审核状态**：待审核